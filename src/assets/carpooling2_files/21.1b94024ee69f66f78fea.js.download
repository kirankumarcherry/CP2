(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"7Z99":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("CcnG"),s=(i("iDA0"),i("t/Na")),a=i("6blF"),o=i("WRZ7"),n=(i("eU/U"),i("mjw4")),d=i("yg5c"),l=i("b6Bi"),c=i("Th9r"),p=i("Z9j4"),u=function(){function e(e,t,i,s,a,o,n){this.dashBoardService=e,this.snackBar=t,this.router=i,this.dialog=s,this.riderListService=a,this.pipe=o,this.showRiderListService=n,this.passangerCheckout=new r.EventEmitter,this.cancelPassengerRide=new r.EventEmitter,this.MapIconLocationUpdate=new r.EventEmitter,this.updateMapIcon=new r.EventEmitter,this.removeRiderRoutePathFromMap=new r.EventEmitter,this.riderJoined=new r.EventEmitter,this.showRiderList=!0,this.showCheckInButton=!0,this.checkInButtons=!1,this.showCancelButton=!0,this.noOfInvitees=0,this.rider=[],this.riders=[],this.riderIds=[],this.riderListReq=[],this.participants=[],this.containReq=!0,this.rideStatus="Finding rider",this.notifications=[],this.CurrentRideProfile=[],this.CurrentRiderDetails=[],this.tempParticipants=[],this.tempRiderDetails=[]}return e.prototype.ngOnInit=function(){if(this.isLoading=!1,this.currentRide=JSON.parse(localStorage.getItem("CurrentRide")),this.profile=JSON.parse(localStorage.getItem("currentUserProfile")),this.CurrentRideProfile=[],this.isJoinedRide=!1,p.a.googleSpotToken===localStorage.getItem("partnerAppToken")?this.getRiderInvitations(this.currentRide.id):localStorage.getItem("riderInviteList")&&0!==JSON.parse(localStorage.getItem("riderInviteList")).length&&(this.riderListReq=JSON.parse(localStorage.getItem("riderInviteList"))),JSON.parse(localStorage.getItem("inputForRider"))&&(this.isLoading=!1,this.checkInButtons=!1,this.getTakeRidePassangerList()),JSON.parse(localStorage.getItem("requestSent"))&&(this.showRiderList=!1,this.findRider&&this.findRider.unsubscribe()),null!==this.currentRide&&(this.isLoading=!1,0!==this.currentRide.rideId&&null!==this.currentRide.rideId&&(this.isJoinedRide=!0,this.checkInButtons=!0)),localStorage.getItem("showCheckInButton")&&(this.showCheckInButton=JSON.parse(localStorage.getItem("showCheckInButton"))),null!==localStorage.getItem("passengerRideTripStatus")&&(this.rideStatus=localStorage.getItem("passengerRideTripStatus")),null!=localStorage.getItem("joinedRiderDetails")){console.log("rider details from localstogare 134 in riderlist",JSON.parse(localStorage.getItem("tempRiderDetails")));var e=JSON.parse(localStorage.getItem("tempRiderDetails"));this.rider=[],this.rider.push({status:e[0].status,gender:e[0].gender,name:e[0].name,vehicleNumber:e[0].vehicleNumber,distance:e[0].distance,imageURI:e[0].imageURI,duration:e[0].duration,contactNo:e[0].contactNo}),this.participants=JSON.parse(localStorage.getItem("Rideparticipants")),console.log("rider and participants in 146 ",this.rider,this.participants)}if(null!==this.currentRide){var t=this.currentRide.status;"Requested"===t?(this.isLoading=!1,this.checkInButtons=!1):(this.checkInButtons=!0,this.showCheckInButton="Scheduled"===t||"Delayed"===t)}},e.prototype.getRiderInvitations=function(e){var t=this,i=setInterval((function(){t.showRiderListService.getInvitations(e).subscribe((function(e){console.log("reide invitations ",e.json(),e.json().resultData),0!=e.json().resultData.length&&(t.riderListReq=e.json().resultData,console.log(t.riderListReq))}),(function(e){console.log("getRiderInvitations",e)})),setTimeout((function(){clearInterval(i)}),0)}),6e4)},e.prototype.ngOnChanges=function(e){if(e.riderStatusObj&&void 0!==e.riderStatusObj.currentValue&&this.riderPickedUp(),e.mqttObj&&void 0!==e.mqttObj.currentValue&&("Rider"===e.mqttObj.currentValue.rideType?this.checkMqttAndUpdateRiderStatus(e.mqttObj.currentValue):"Passenger"===e.mqttObj.currentValue.rideType&&this.checkMqttAndUpdatePsgrStatus(e.mqttObj.currentValue)),e.riderInvitationObj)if(void 0!==e.riderInvitationObj.currentValue){if(localStorage.getItem("riderInviteList")&&0!==JSON.parse(localStorage.getItem("riderInviteList")).length){this.riderListReq=JSON.parse(localStorage.getItem("riderInviteList"));for(var t=0;t<this.riderListReq.length;t++)e.riderInvitationObj.currentValue.invitingUserId===this.riderListReq[t].invitingUserId&&(this.containReq=!1);this.containReq&&(this.riderListReq.push(e.riderInvitationObj.currentValue),localStorage.setItem("riderInviteList",JSON.stringify(this.riderListReq)),this.riderIds.push(e.riderInvitationObj.currentValue.invitingUserId),this.containReq=!0),5===this.riderListReq.length&&(this.riderListReq.splice(0,2),localStorage.setItem("riderInviteList",JSON.stringify(this.riderListReq)),this.riderListReq=JSON.parse(localStorage.getItem("riderInviteList")))}else this.riderListReq.push(e.riderInvitationObj.currentValue),localStorage.setItem("riderInviteList",JSON.stringify(this.riderListReq));this.router.navigateByUrl("/notification_bell")}else null!==JSON.parse(localStorage.getItem("riderInviteList"))&&(this.riderListReq=JSON.parse(localStorage.getItem("riderInviteList")));e.RiderRequest&&void 0!==e.RiderRequest.currentValue&&(console.log("Rider joined happen1"),this.RiderRequest&&(console.log("Rider joined happen2",this.mqttObj),this.acceptRidersInvite(this.mqttObj)))},e.prototype.checkMqttAndUpdateRiderStatus=function(e){if(void 0!==e)if("Accepted"===e.invitationStatus)this.riderAcceptedTheRequest(e);else if("Cancelled"===e.invitationStatus)this.riderCancelledTheInvitation(e);else if("RideCancelled"===e.invitationStatus)this.updateRiderCancelledRide(e);else if("JoinedSameRide"===e.invitationStatus);else if("Started"===e.status){var t=JSON.parse(localStorage.getItem("tempRiderDetails"));this.rider=[],this.rider.push({status:e.status,gender:t[0].gender,name:t[0].name,vehicleNumber:t[0].vehicleNumber,distance:t[0].distance,imageURI:t[0].imageURI,duration:t[0].duration,contactNo:t[0].contactNo}),console.log("Ride started in map 284",this.rider),localStorage.setItem("tempRiderDetails",JSON.stringify(this.rider))}else"UnJoined"===e.invitationStatus?(console.log("updated unjoined called in rider list 231"),this.updateRiderCancelledRide(e)):console.log("received mqtt1: ",e)},e.prototype.checkMqttAndUpdatePsgrStatus=function(e){void 0!==e&&("Accepted"===e.invitationStatus?this.riderAcceptedTheRequest(e):"Cancelled"===e.invitationStatus||"Cancelled"===e.status?this.updateRiderCancelledRide(e):"JoinedSameRide"===e.invitationStatus||("Received"===e.invitationStatus?this.updateRideInviteReceivedStatus(e):"Read"===e.invitationStatus?this.updateRideInviteReadStatus(e):"Scheduled"===e.invitationStatus||("RideCancelled"===e.invitationStatus?this.updateRiderCancelledRide(e):"Rejected"===e.invitationStatus?this.riderRejectedTheRequest(e):"Completed"===e.status?this.riderDrappedOff(e):"Rider"==e.joinedRideType&&e.joinedRideId==localStorage.getItem("riderRideIdJoined")?(console.log("updatePraticipantsListOnParticipantJoinin riderlist"),this.updatePraticipantsListOnParticipantJoin(e)):console.log("received mqtt2: ",e))))},e.prototype.cancel=function(){this.cancelPassengerRide.emit(!0),this.findRider.unsubscribe()},e.prototype.getJoinedRider=function(){var e=this;if(JSON.parse(localStorage.getItem("riderRideIdJoined"))){var t=JSON.parse(localStorage.getItem("riderRideIdJoined")),i=new s.h;i=i.append("id",t),console.log("input",t);var r=JSON.parse(localStorage.getItem("userId"));this.findJoinedRider=a.a.interval(5e3).subscribe((function(t){e.dashBoardService.getRideDetails(i).subscribe((function(t){e.findJoinedRider.unsubscribe(),e.riders=t.resultData,console.log("riderslist",e.riders),localStorage.setItem("CurrentRideRiderDetails",JSON.stringify(e.rider)),e.riders=e.riders.filter((function(e){return e.userId!==r})),console.log(e.riders),e.checkInButtons=!0}))}))}},e.prototype.checkIn=function(){var e=this,t=JSON.parse(localStorage.getItem("CurrentRide")),i=JSON.parse(localStorage.getItem("riderRideIdJoined"));if(JSON.parse(localStorage.getItem("riderRideIdJoined"))){var r=new s.h;r=(r=(r=(r=(r=r.append("updateByRider","false")).append("riderRideId",i)).append("status","Started")).append("userId",t.userId)).append("id",t.id),this.dashBoardService.checkInPassenger(r).subscribe((function(t){e.showCheckInButton=!1,localStorage.setItem("showCheckInButton","false"),e.findJoinedRider.unsubscribe()}))}},e.prototype.checkOut=function(){var e=this,t=JSON.parse(localStorage.getItem("riderRideIdJoined")),i=new s.h;i=i.append("id",this.currentRide.id),this.dashBoardService.checkOutPassenger(i).subscribe((function(i){e.passangerCheckout.emit(t),localStorage.removeItem("joinedRiderDetails"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("tempRiderDetails"),localStorage.removeItem("showCheckInButton"),localStorage.removeItem("riderRideIdJoined"),localStorage.removeItem("riderRideIdJoined"),localStorage.removeItem("showCurrentRide"),localStorage.removeItem("CurrentRide"),localStorage.removeItem("currentRide"),localStorage.removeItem("riderInviteList"),e.findRider.unsubscribe()}))},e.prototype.getTakeRidePassangerList=function(){var e=this,t=0,i=JSON.parse(localStorage.getItem("inputForRider")),r=i.id;this.findRider=a.a.interval(5e3).subscribe((function(a){if(4==(t+=1))e.findRider.unsubscribe();else{var o=new s.h;o=(o=(o=(o=(o=(o=(o=(o=(o=o.append("id",r)).append("startLatitude",i.startLatitude)).append("startLongitude",i.startLongitude)).append("endLatitude",i.endLatitude)).append("endLongitude",i.endLongitude)).append("startTime",i.startTime)).append("userId",i.userId)).append("route",i.routePathPolyline)).append("noOfSeats",i.noOfSeats),e.dashBoardService.findMatchingRiders(o).subscribe((function(t){e.riderList=t.resultData.matchedRiders,e.CurrentRideProfile=e.riderList[0],console.log(e.CurrentRideProfile),e.noOfInvitees=e.riderList.length,0!==e.riderList.length&&(e.showCancelButton=!1),localStorage.setItem("riderList",JSON.stringify(e.riderList)),localStorage.setItem("inputForRider",JSON.stringify(i)),!0===JSON.parse(localStorage.getItem("firstTimeNavToMatchedUsers"))&&0!==e.noOfInvitees&&(e.seeRiderList(),localStorage.setItem("firstTimeNavToMatchedUsers",JSON.stringify(!1))),e.findRider.unsubscribe()}))}}))},e.prototype.ngOnDestroy=function(){null!=this.findRider&&this.findRider.unsubscribe()},e.prototype.viewProfile=function(e){var t=this,i=new s.h;i=i.append("id",e.userId),this.riderListService.getUserProfile(i).subscribe((function(i){var r=i.resultData,s=Number(r.noofridesaspassenger)+Number(r.noofridesasrider);console.log("total rides ssgsdgsdg",r.onTimeComplianceRating),i.resultData.contactNo=e.contactNo,i.resultData.name=r.userName,i.resultData.companyName=r.companyname,i.resultData.totalNoOfRideShared=s,i.resultData.userOnTimeComplianceRating=r.onTimeComplianceRating,localStorage.setItem("riderProfileViewObjectFromAcceptedList",JSON.stringify(i.resultData)),t.router.navigate(["/rider-profile"],{queryParams:{from:"acceptedList"}})}),(function(e){}))},e.prototype.openrequest=function(){this.router.navigate(["/rider-ride-details"])},e.prototype.seeRiderList=function(){this.router.navigate(["/rider-invite-list"])},e.prototype.openSnackBar=function(e,t){this.snackBar.open(e,t,{duration:2e3})},e.prototype.openRideInviteDialog=function(e){var t=this;this.dialog.open(o.a,{autoFocus:!1,data:e}).afterClosed().subscribe((function(e){"ACCEPT"===e.status?t.acceptRidersInvite(e):"DECLINE"===e.status&&t.declineRidersInvite(e)}))},e.prototype.acceptRidersInvite=function(e){var t=this;localStorage.setItem("gpayInviteObj",JSON.stringify(e));var i=this.pipe.transform(e.pickupTime,"ddMMyyyyhhmm"),r=this.pipe.transform(e.dropTime,"ddMMyyyyhhmm"),a=new s.h;a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a.append("id",e.rideId)).append("userId",e.riderId)).append("passengerRideId",e.passengerRideId)).append("passengerId",e.passengerId)).append("pickupAddress",e.pickupAddress)).append("pickupLatitude",e.pickupLatitude)).append("pickupLongitude",e.pickupLongitude)).append("pickupTime",i)).append("dropAddress",e.dropAddress)).append("dropLatitude",e.dropLatitude)).append("dropLongitude",e.dropLongitude)).append("dropTime",r)).append("distance",e.matchedDistance)).append("points",e.points)).append("availableSeats",e.noOfSeats)).append("Invitation_id",e.id)).append("newFare",e.newFare)).append("fareChange",e.fareChange)).append("savePickupDropPoints",e.savePickupDropPoints)).append("preferredPickupDropId",e.prefPickupDropId)).append("distanceOnPsgrRoute",e.distanceOnPassengerRoute)).append("pickupDropRecalcualtionBasedOnTraffic","true")).append("pkTime",e.pkTime)).append("dpTime",e.dpTime)).append("matchPerOfPassenger",e.matchPercentageOnPassengerRoute)).append("matchPerOfRider",e.matchPercentageOnRiderRoute),p.a.googleSpotToken===localStorage.getItem("partnerAppToken")&&(a=a.append("paymentType",p.a.GPAY_SPOT)),a=a.append("rideType",e.rideType),this.riderListService.acceptRidersInvite(a).subscribe((function(i){if("SUCCESS"===i.result){var r=new s.h;r=r.append("id",e.passengerRideId),t.riderListService.getPassengerRide(r).subscribe((function(i){localStorage.setItem("CurrentRide",JSON.stringify(i.resultData)),t.getCurrentRiderDetails(e.riderRideId,e.passengerRideId,e)}));for(var a=0;a<t.riderListReq.length;a++)t.riderListReq[a].invitingUserId===e.riderId&&t.riderListReq.splice(a,1);t.riderListReq=[],t.isJoinedRide=!0,localStorage.removeItem("riderInviteList");var o=new s.h;o=o.append("id",e.rideId),t.riderListService.getParticipantsOfRide(o).subscribe((function(e){t.participants=e.resultData})),localStorage.setItem("riderRideIdJoined",e.rideId),t.checkInButtons=!0,t.removeNotification(e)}}),(function(i){t.openSnackBar(i.error.resultData.userMsg,""),"1402"==i.error.resultData.errorCode&&t.getTransactionId(e.passengerRideId,e.passengerId,i.error.resultData.extraInfo.OrderId,i.error.resultData.extraInfo.Total)}))},e.prototype.getTransactionId=function(e,t,i,r){var s=this;console.log("getTransactionId"),this.showRiderListService.getTransactionId(t,i,p.a.GPAY_SPOT,r).subscribe((function(a){console.log("data",a.json(),a.json().resultData),console.log("1",a.json().resultData,a.json().resultData.intentFlowLink);var o=JSON.parse('{"'+decodeURI(a.json().resultData.intentFlowLink.split("?")[1].replace(/&/g,'","').replace(/=/g,'":"'))+'"}'),n=a.json().resultData.refTransactionId;s.spotInitPayment(e,t,i,r,o,n)}),(function(e){s.openSnackBar(e.error.resultData.userMsg,"")}))},e.prototype.spotInitPayment=function(e,t,i,r,a,o){initPaymentFromSpot(i,r,a,p.a.GPAY_MERCHANT_ID,p.a.S3_QR_LOGO,p.a.RAZOR_PAY_EMRCHANT_ID);var n=this,d=setInterval((function(){var a=localStorage.getItem(i);if(null!=a&&"yes"==a&&null==localStorage.getItem("payment_started")){localStorage.setItem("payment_started","yes"),console.log("yes",localStorage.getItem(i));var l=new s.h;l=(l=(l=(l=(l=(l=l.append("userId",t)).append("rideId",e)).append("orderId",i)).append("paymentId",o)).append("amount",r)).append("processInivtes","true"),n.showRiderListService.updatePaymentStatus(l).subscribe((function(e){n.openSnackBar("Joined successfully",""),localStorage.removeItem(i),localStorage.removeItem("payment_started"),setTimeout((function(){clearInterval(d)}),0),window.location.reload()}),(function(e){n.openSnackBar(e.error.resultData.userMsg,""),localStorage.removeItem(i),localStorage.removeItem("payment_started"),setTimeout((function(){clearInterval(d)}),0)}))}}),600)},e.prototype.declineRidersInvite=function(e){var t=this;this.dialog.open(n.a,{autoFocus:!1}).afterClosed().subscribe((function(i){t.reason=i.reason,void 0===t.reason&&(t.reason="None"),"CONFIRM_DECLINE"===i.status&&t.declineInvite(e)}))},e.prototype.declineInvite=function(e){var t=this,i=new s.h;i=(i=(i=(i=(i=(i=i.append("id",e.rideId)).append("userId",e.riderId)).append("passengerRideId",e.passengerRideId)).append("passengerId",e.passengerId)).append("Invitation_id",e.id)).append("rejectReason",this.reason),this.riderListService.declineRidersInvite(i).subscribe((function(i){for(var r=0;r<t.riderListReq.length;r++)t.riderListReq[r].invitingUserId===e.riderId&&t.riderListReq.splice(r,1);for(console.log("inviteObj",e),console.log("this.riderListReq",t.riderListReq),0!==t.riderListReq.length?localStorage.setItem("riderInviteList",t.riderListReq):localStorage.removeItem("riderInviteList"),r=0;r<t.riderIds.length;r++)t.riderIds[r]===e.passengerId&&t.riderIds.splice(r,1);console.log("call on init"),t.ngOnInit(),t.removeNotification(e)}),(function(e){t.dialog.open(d.a,{autoFocus:!1,data:e.json().resultData.userMsg})}))},e.prototype.removeNotification=function(e){localStorage.getItem("notification")&&(this.notifications=JSON.parse(localStorage.getItem("notification")));for(var t=0;t<this.notifications.length;t++)e.riderId===this.notifications[t].sendFrom&&"RM_PASSENGER_INVITATION"===this.notifications[t].type&&this.notifications.splice(t,1);localStorage.setItem("notification",JSON.stringify(this.notifications))},e.prototype.openMenuDialog=function(e){var t=this;console.log("unj: ",e),!0===e.rider&&this.dialog.open(c.a,{data:{number:e.contactNo}}).afterClosed().subscribe((function(i){"UNJOIN"===i?t.unjoinRide(e):"VIEW"===i&&t.viewProfile(e)}))},e.prototype.unjoinRide=function(e){var t=this,i=new s.h;i=(i=(i=(i=i.append("id",e.rideId)).append("passengerRideId",this.currentRide.id)).append("rideType","Passenger")).append("cancelReason","Passenger unjoined the ride"),this.riderListService.unjoinRide(i).subscribe((function(e){"SUCCESS"===e.result&&(localStorage.setItem("CurrentRide",JSON.stringify(e.resultData)),t.participants=[],t.checkInButtons=!1,t.isJoinedRide=!1,t.rider=[],t.updateMapIcon.emit(!0),localStorage.removeItem("joinedRiderDetails"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("riderRideIdJoined"),localStorage.removeItem("tempRiderDetails"),localStorage.removeItem("riderRideIdJoined"))}))},e.prototype.updateRiderCancelledRide=function(e){this.participants=[],this.checkInButtons=!1,this.isJoinedRide=!1,this.rider=[],localStorage.removeItem("joinedRiderDetails"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("riderRideIdJoined"),localStorage.removeItem("tempRiderDetails"),localStorage.removeItem("riderRideIdJoined")},e.prototype.riderCancelledTheInvitation=function(e){var t=new s.h;t=t.append("id",e.passengerRideId),this.riderListService.getPassengerRide(t).subscribe((function(e){localStorage.setItem("CurrentRide",JSON.stringify(e.resultData))}));for(var i=0;i<this.riderListReq.length;i++)this.riderListReq[i].invitingUserId===e.riderUserId&&this.riderListReq.splice(i,1);localStorage.setItem("riderInviteList",this.riderListReq),this.participants=[],this.checkInButtons=!1,this.isJoinedRide=!1},e.prototype.riderAcceptedTheRequest=function(e){var t=this,i=new s.h;i=i.append("id",e.passengerRideId),this.riderListService.getPassengerRide(i).subscribe((function(i){console.log("Rider Accept Invite 733",e),localStorage.setItem("CurrentRide",JSON.stringify(i.resultData)),t.getCurrentRiderDetails(e.riderRideId,e.passengerRideId,e)}));for(var r=0;r<this.riderListReq.length;r++)this.riderListReq[r].invitingUserId===e.riderUserId&&this.riderListReq.splice(r,1);this.isJoinedRide=!0,localStorage.removeItem("riderInviteList")},e.prototype.getcurrentRideparticipants=function(e){var t=this;console.log("rideId 778",e);var i=new s.h;i=i.append("id",e.riderRideId),this.riderListService.getParticipantsOfRide(i).subscribe((function(i){t.MapIconLocationUpdate.emit(!0);var r=[];r=i.resultData,console.log("participants data in rider list in 756",r);var s=localStorage.getItem("userId"),a=e.riderUserId;console.log("riderrideId",a);var o=[];if(r.length>0){for(var n=0;n<r.length;n++)if(console.log("condition matching rider",typeof r[n].userId,typeof a,r[n].userId,a,r[n].userId!=a),r[n].userId!=a)console.log("Rider name",r[n].name,s==r[n].userId,typeof s,typeof r[n].userId),s==r[n].userId&&(r[n].name="You"),o.push(r[n]),console.log("particular participants",r[n],n);else if(r[n].userId==a){var d=JSON.parse(localStorage.getItem("joinedRiderDetails"));console.log("joinedRiderDetails",d),t.rider=[];var l={status:d.status,gender:r[n].gender,name:d.userName,vehicleNumber:d.vehicleNumber,distance:d.distance,imageURI:r[n].imageURI,duration:d.durationOfRide,contactNo:r[n].contactNo};localStorage.setItem("riderRideIdJoined",r[n].riderRideId),console.log("rider object 790",l),t.rider.push(l),localStorage.setItem("tempRiderDetails",JSON.stringify(t.rider))}t.participants=o,console.log("after",t.participants),localStorage.setItem("Rideparticipants",JSON.stringify(t.participants))}for(console.log("fullparticipants",r,r.length),n=0;n<r.length;n++)e.riderUserId===r[n].userId&&(t.yayData={invitingUserName:r[n].name,pickupAddress:r[n].startAddress,rideId:r[n].riderRideId,passengerRideId:t.currentRide.id});t.checkInButtons=!0,t.yayDialog(t.yayData)})),localStorage.setItem("riderRideIdJoined",e.riderRideId),this.checkInButtons=!0,this.riderJoined.emit(!0)},e.prototype.yayDialog=function(e){this.dialog.open(l.a,{data:e})},e.prototype.updateRideInviteReceivedStatus=function(e){if(void 0!==e){localStorage.getItem("riderInviteList")&&0!==JSON.parse(localStorage.getItem("riderInviteList")).length&&(this.riderListReq=JSON.parse(localStorage.getItem("riderInviteList")));for(var t=0;t<this.riderListReq.length;t++)e.riderUserId===this.riderListReq[t].invitingUserId&&(this.riderListReq[t].passengerRequest="RECEIVED");localStorage.setItem("riderInviteList",JSON.stringify(this.riderListReq)),this.riderIds.push(e.riderUserId),this.ngOnInit()}},e.prototype.updateRideInviteReadStatus=function(e){if(void 0!==e){localStorage.getItem("riderInviteList")&&0!==JSON.parse(localStorage.getItem("riderInviteList")).length&&(this.riderListReq=JSON.parse(localStorage.getItem("riderInviteList")));for(var t=0;t<this.riderListReq.length;t++)e.riderUserId===this.riderListReq[t].invitingUserId&&(this.riderListReq[t].passengerRequest="READ");localStorage.setItem("riderInviteList",JSON.stringify(this.riderListReq)),this.riderIds.push(e.riderUserId),this.ngOnInit()}},e.prototype.riderPickedUp=function(){var e=this,t=JSON.parse(localStorage.getItem("CurrentRide"));if(0!==t.ride){var i=new s.h;i=(i=(i=(i=(i=i.append("updateByRider","true")).append("riderRideId",t.rideId)).append("status","Started")).append("userId",t.userId)).append("id",t.id),this.dashBoardService.checkInPassenger(i).subscribe((function(t){e.showCheckInButton=!1,localStorage.setItem("showCheckInButton","false"),e.showCheckInButton=JSON.parse(localStorage.getItem("showCheckInButton")),e.findJoinedRider.unsubscribe()}))}},e.prototype.riderDrappedOff=function(e){var t=this,i=JSON.parse(localStorage.getItem("riderRideIdJoined")),r=new s.h;r=r.append("id",e.rideId),this.dashBoardService.checkOutPassenger(r).subscribe((function(e){t.passangerCheckout.emit(i),localStorage.removeItem("showCheckInButton"),localStorage.removeItem("riderRideIdJoined"),localStorage.removeItem("showCurrentRide"),localStorage.removeItem("CurrentRide"),localStorage.removeItem("currentRide"),localStorage.removeItem("joinedRiderDetails"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("riderRideIdJoined"),localStorage.removeItem("tempRiderDetails"),localStorage.removeItem("riderRideIdJoined"),t.findRider.unsubscribe()}))},e.prototype.getAllParticipants=function(e){var t=this;console.log("rideId 936",e);var i=new s.h;i=i.append("id",e),this.riderListService.getParticipantsOfRide(i).subscribe((function(e){var i=e.resultData;console.log("participants data in rider list in 904",i);var r=localStorage.getItem("userId"),s=JSON.parse(localStorage.getItem("JoinedRiderDetails")).userId;console.log("riderrideid",s);var a=[];if(i.length>0){for(var o=0;o<i.length;o++)if(console.log(null!=localStorage.getItem("PassengerJoinedRiderUserId")),null!=localStorage.getItem("PassengerJoinedRiderUserId")){if(i[o].userId!==parseInt(s))console.log("Rider name",i[o].name,r==i[o].userId,typeof r,typeof i[o].userId),r==i[o].userId&&(i[o].name="You"),a.push(i[o]),console.log("particular participants 909",i[o]);else if(i[o].userId==s){var n=JSON.parse(localStorage.getItem("joinedRiderDetails"));t.rider=[];var d={status:n.status,gender:i[o].gender,name:n.userName,vehicleNumber:n.vehicleNumber,distance:n.distance,imageURI:i[o].imageURI,duration:n.durationOfRide,contactNo:i[o].contactNo};localStorage.setItem("riderRideIdJoined",i[o].riderRideId),console.log("rider object 935",d),t.rider.push(d),localStorage.setItem("tempRiderDetails",JSON.stringify(t.rider))}}else a.push(i[o]),console.log("particular participants 917",i[o]);t.participants=a,console.log("after",t.participants),localStorage.setItem("Rideparticipants",JSON.stringify(t,i))}}))},e.prototype.riderRejectedTheRequest=function(e){this.riderListReq=JSON.parse(localStorage.getItem("riderInviteList"));for(var t=0;t<this.riderListReq.length;t++)e.riderUserId===this.riderListReq[t].invitingUserId&&(this.riderListReq.splice(t,1),0!==this.riderListReq.length?localStorage.setItem("riderInviteList",this.riderListReq):localStorage.removeItem("riderInviteList"))},e.prototype.getCurrentRiderDetails=function(e,t,i){var r=this;this.riderListService.getRiderRideData(e).subscribe((function(e){console.log("current Rider Deatils 948",e),localStorage.setItem("joinedRiderDetails",JSON.stringify(e.resultData)),r.getCurrentPassengerDetails(t,i)}),(function(e){console.log(e)}))},e.prototype.getCurrentPassengerDetails=function(e,t){var i=this;this.riderListService.getPassengerRideData(e).subscribe((function(e){console.log("current Rider Deatils 948",e),localStorage.setItem("PassengerRouteDetails",JSON.stringify(e.resultData)),i.getcurrentRideparticipants(t)}),(function(e){console.log(e)}))},e.prototype.updatePraticipantsListOnParticipantJoin=function(e){var t=this,i=new s.h;i=i.append("id",e.joinedRideId),this.riderListService.getParticipantsOfRide(i).subscribe((function(e){var i=[];i=e.resultData,console.log("participants data in rider list in 756",i);var r=localStorage.getItem("userId"),s=JSON.parse(localStorage.getItem("joinedRiderDetails")).userId;console.log("riderrideId",s);var a=[];if(i.length>0){for(var o=0;o<i.length;o++)console.log("condition matching rider",typeof i[o].userId,typeof s,i[o].userId,s,i[o].userId!=s),i[o].userId!=s&&(console.log("Rider name",i[o].name,r==i[o].userId,typeof r,typeof i[o].userId),r==i[o].userId&&(i[o].name="You"),a.push(i[o]),console.log("particular participants",i[o],o));t.participants=a,console.log("after",t.participants),localStorage.setItem("Rideparticipants",JSON.stringify(t,i))}}))},e}()},"811X":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var r={GET_VEHICLES:"/vehicle/all/vehicles",ADD_VEHICLE:"/vehicle",UPDATE_VEHICLE:"/vehicle/update"}},Th9r:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var r=function(){function e(e,t){this.dialogRef=e,this.data=t}return e.prototype.ngOnInit=function(){},e.prototype.unjoinRide=function(){this.dialogRef.close("UNJOIN")},e.prototype.viewProfile=function(){this.dialogRef.close("VIEW")},e}()},WRZ7:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i("eU/U");var r=i("t/Na"),s=function(){function e(e,t,i){this.dialogRef=e,this.data=t,this.riderListService=i}return e.prototype.ngOnInit=function(){this.getMatchedRiders()},e.prototype.acceptInvite=function(){this.data.status="ACCEPT",this.dialogRef.close(this.data)},e.prototype.declineInvite=function(){this.data.status="DECLINE",this.dialogRef.close(this.data)},e.prototype.getMatchedRiders=function(){var e=this,t=new r.h;t=(t=t.append("riderRideId",this.data.rideId)).append("passengerRideId",this.data.passengerRideId),this.riderListService.getMatchedRiders(t).subscribe((function(t){e.tempObj=t.resultData}))},e}()},b6Bi:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i("eU/U");var r=i("t/Na"),s=function(){function e(e,t,i){this.dialogRef=e,this.data=t,this.riderListService=i}return e.prototype.ngOnInit=function(){this.getMatchedRiders(),console.log("data.pkTime",this.data)},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.getMatchedRiders=function(){var e=this,t=new r.h;t=(t=t.append("riderRideId",this.data.rideId)).append("passengerRideId",this.data.passengerRideId),this.riderListService.getMatchedRiders(t).subscribe((function(t){e.tempObj=t.resultData,console.log("tempObj new pktime check",e.tempObj)}))},e}()},mBJu:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("sE5F"),s=i("AytR"),a=i("811X"),o=function(){function e(e,t){this.http=e,this.http1=t,this.rideMgmt=s.a.RIDE_MANAGEMENT_SERVER,this.vehicleUrl=s.a.RIDE_MANAGEMENT_SERVER+a.a.GET_VEHICLES,this.placessuggestionApi=s.a.ROUTE_REPOSITORY_SERVER+"/location/autocomplete",this.geocode=s.a.ROUTE_REPOSITORY_SERVER+"/location/geocode/address"}return e.prototype.getAllVehicles=function(e){return this.http1.get(this.vehicleUrl,{params:e})},e.prototype.changePassword=function(e){return this.http.put(this.rideMgmt+"/password",e)},e.prototype.addFavouriteLocation=function(e){return this.http1.post(this.rideMgmt+"/userpreferences/favouriteLocations",e)},e.prototype.getFavouriteLocation=function(e){return this.http1.get(this.rideMgmt+"/userpreferences/favouritelocations",{params:e})},e.prototype.updateFavouriteLocation=function(e){return this.http1.put(this.rideMgmt+"/userpreferences/favouritelocations/update",e)},e.prototype.deleteFavouriteLocation=function(e){return this.http1.delete(this.rideMgmt+"/userpreferences/favouritelocations/delete",{params:e})},e.prototype.checkEmailActivation=function(e){return this.http1.put(this.rideMgmt+"/userprofile/emailverification/code",e)},e.prototype.updateUserProfile=function(e){return this.http1.put(this.rideMgmt+"/userprofile/update",e)},e.prototype.getBasicInfoOfAUser=function(e){return this.http1.get(this.rideMgmt+"/userprofile/basicinfo",{params:e})},e.prototype.PlacesSuggestion=function(e,t,i,s){var a=localStorage.getItem("userId"),o=new r.Headers({"APP-TOKEN":localStorage.getItem("partnerAppToken"),Authorization:localStorage.getItem("token")});return this.http.get(this.placessuggestionApi+"?useCase=PWA&id="+a+"&charSequence="+e+"&latitude="+t+"&longitude="+i+"&readFromGoogle="+s,{headers:o})},e.prototype.getLatLngFromAddress=function(e){var t=new r.Headers({"APP-TOKEN":localStorage.getItem("partnerAppToken"),"Content-Type":"application/x-www-form-urlencoded",Authorization:localStorage.getItem("token")});return this.http.get(this.geocode,{params:e.toString(),headers:t})},e}()},txlp:function(e,t,i){"use strict";i("iDA0");var r=i("88/t"),s=i("6blF"),a=i("xXU7");s.a.interval=a.a;var o=i("CIo6"),n=i("o9EK"),d=(i("n31z"),i("t/Na")),l=(i("emV6"),i("7Z99"),i("yg5c")),c=(i("mBJu"),i("F5nt"),i("Z9j4"));i.d(t,"a",(function(){return p}));var p=function(){function e(e,t,i,r,s,a,o){var l=this;this.dashboardService=e,this.snackBar=t,this.router=i,this.firebaseMessagingService=r,this.dialog=s,this.profileService=a,this.appService=o,this.host="18.204.180.111",this.port=1883,this.uuid=n.UUID.UUID(),this.messages=[],this.rider=[],this.showPassengerTripReport=!1,this.showPassengerFeedback=!1,this.restFlag=!1,this.passengerList=[],this.showRide=!0,this.currentAddress="",this.showCurrentRideDetails={vehicleModel:"",vehicleNumber:"",startTime:"",startAddress:"",endAddress:"",vehicleType:""},this.showRiderList=!1,this.showAcceptInvite=!1,this.showMap=!0,this.pushRightClass="push-right",this.uniqueId=[],this.passengerRidePosted=!1,this.PassengerJoinedAlert=!1,this.RiderRequest=!1,this.RiderJoinedPassengerRide=!1,this.PassengerCheckInAlert=!1,this.RiderRideCompleted=!1,this.NoOfPassengerJoined=!1,this.mapIconLocationUpdate=!1,this.callMyRide="",this.updateMapIcon=!1,this.unjoinedPassengerId="",this.updateIconPosition=!1,this.userCurrentRideRole="",this.hideRiderRoutePathFromMap=!1,this.getRiderDetails=function(){var e=new d.h;e=e.append("id",l.userId.toString()),l.dashboardService.getRiderDetails(e).subscribe((function(e){localStorage.setItem("riderUserProfile",JSON.stringify(e.resultData)),l.profileName=e.resultData.userName}))},this.passangerRideId=null,this.reschedulePassanger=null,this.sidebarClass="sidebar-show",this.isClosable=!0;var c=this.router.getCurrentNavigation();if(void 0!==c.extras.state){var p=c.extras.state;this.rideObject=p.upcomingRide,console.log("from upcoming ",this.rideObject,p.upcomingRide),void 0!==this.rideObject&&this.getRouteData(this.rideObject),p.setNewRide&&this.cacheCleanup()}this.subscription=this.firebaseMessagingService.getMessage().subscribe((function(e){console.log("this.newMessageReceived dashboard",e),l.newMessageReceived(e)})),this.getFavLocation()}return e.prototype.recordPWALog=function(e,t,i,r,s,a){this.appService.recordPWALog({mobile:e,page:t,action:i,result:r,comments_1:s,comments_2:a})},e.prototype.connectToMqttBroker=function(){this._client=new o.Paho.MQTT.Client("events.getquickride.com",15675,"/ws",this.uuid)},e.prototype.onConnected=function(){console.log("Connected to broker.")},e.prototype.getRiderRideData=function(e,t){var i=this;this.dashboardService.getRiderRideData(e).subscribe((function(r){"Completed"===r.resultData.status||"Cancelled"===r.resultData.status?(i.cacheCleanup(),window.location.reload()):t&&(console.log("rider ride data from server ",r.resultData),localStorage.setItem("CurrentRide",JSON.stringify(r.resultData)),localStorage.setItem("riderRideIdJoined",e),i.rideStart="Scheduled"!==r.resultData.status&&"Delayed"!==r.resultData.status)}))},e.prototype.getPassengerRideData=function(e,t){var i=this;this.dashboardService.getPassengerRideData(e).subscribe((function(e){"Completed"===e.resultData.status||"Cancelled"===e.resultData.status?(i.cacheCleanup(),window.location.reload()):t&&(console.log("passenger ride data from server "),localStorage.setItem("CurrentRide",JSON.stringify(e.resultData)),localStorage.setItem("riderRideIdJoined",e.resultData.rideId))}))},e.prototype.checkExistingRide=function(){var e=JSON.parse(localStorage.getItem("CurrentRide"));JSON.parse(localStorage.getItem("CurrentRide"))&&("Rider"===e.dataAsMap.rideType?this.getRiderRideData(e.id,!0):"Passenger"===e.dataAsMap.rideType&&this.getPassengerRideData(e.id,!0))},e.prototype.ngOnInit=function(){this.getEncashInfo(),this.notificationcount="",localStorage.setItem("notificationcount",""),this.Ridestatusupdated=!1,this.testApiCnt(),this.checkExistingRide(),this.initializeFirebase(),this.showMap=!0,this.showMenuIcon=!0,this.headerEnable=null!=localStorage.getItem("showCurrentRide"),console.log("toggleSidebar 4",!1);var e=JSON.parse(localStorage.getItem("CurrentRide"));if(JSON.parse(localStorage.getItem("requestSentToRider"))&&"Passenger"===e.dataAsMap.rideType&&(this.showRiderList=!0,this.showRideInfo=!1,this.showRide=!1),console.log("currentRideObj ",e),JSON.parse(localStorage.getItem("CurrentRide"))||JSON.parse(localStorage.getItem("currentRide"))||this.showRide||(this.cacheCleanup(),window.location.reload()),JSON.parse(localStorage.getItem("CurrentRide")))"Rider"===e.dataAsMap.rideType?(this.showRideInfo=!0,this.showRide=!1,this.ridePosted=!0,this.showRiderList=!1):"Passenger"===e.dataAsMap.rideType&&(this.showRideInfo=!1,this.showRide=!1,this.showRiderList=!0);else if(JSON.parse(localStorage.getItem("currentRide"))){var t=JSON.parse(localStorage.getItem("currentRide"));"Rider"===t.dataAsMap.rideType?this.getRiderRideData(t.id,!1):"Passenger"===t.dataAsMap.rideType&&this.getPassengerRideData(t.id,!1)}JSON.parse(localStorage.getItem("invitePassenger"))&&(this.showRideInfo=!0,this.showRide=!1,this.ridePosted=!0),this.showEditRideForm=!1,this.currentRideObject=this.dashboardService.getCurrentRideObj(),this.defaultVehicle={},this.invitationAccepted=!1,this.showDirection=!1,void 0===this.rideObject&&this.getLocalData(),this.getDefaultVehicle(),this.getCurrentTime(),this.getAllRides(),this.destinationAddress=null,this.currentRide&&(this.lat=this.currentRide.startLatitude,this.lng=this.currentRide.startLongitude,this.destLat=this.currentRide.endLatitude,this.destLng=this.currentRide.endLongitude,this.rideId=this.currentRide.id,this.latlng={lat:this.lat,lng:this.lng},this.destLatLong={lat:this.destLat,lng:this.destLng}),(this.rideStart||this.ridePosted)&&(this.showRideInfo=!0,this.showRide=!1),JSON.parse(localStorage.getItem("riderList"))&&null!==e&&"Passenger"===e.dataAsMap.rideType&&0!==JSON.parse(localStorage.getItem("riderList")).length&&(console.log("fsfasfas",JSON.parse(localStorage.getItem("riderList"))),this.showRiderList=!0,this.showRide=!1,this.showRideInfo=!1,this.riderList=JSON.parse(localStorage.getItem("riderList"))),this.recordPWALog("","dashboard","open","","","")},e.prototype.testApiCnt=function(){var e=this,t=0;this.testApi=r.Observable.interval(1e4).subscribe((function(i){t+=1,console.log("ApiCnt",t),3==t&&e.testApi.unsubscribe()}))},e.prototype.mqttMessageReceived=function(e){if(null!==e){var t=JSON.parse(e.payloadString);console.log("Real mqtt ",t),this.uniqueId.includes(t.uniqueID)||(console.log("Real mqtt 1"),"noti"===t.msgObjType?(console.log("Real mqtt 2"),this.msgObj=JSON.parse(t.msgObjectJson),"RM_RIDER_INVITATION"!==t.Type&&"RM_PASSENGER_INVITATION"!==t.Type&&"NOT_TYPE_RM_INVITATION_TO_OLD_USER"!==t.Type&&"NOT_TYPE_RM_CONTACT_INVITATION"!==t.Type&&"RM_RIDER_INVITATION_REQ_FARE"!==t.Type||(console.log("Real mqtt 3"),this.updateInvitationStatusAsRead(this.msgObj)),"RM_RIDER_INVITATION"===t.type?(this.passengerAllStat=this.msgObj,this.openSnackBar(t.title+t.description,""),console.log("Real mqtt 4")):"RM_PASSENGER_INVITATION"===t.type?(this.riderInvitationObj=this.msgObj,this.openSnackBar(t.title+t.description,"")):"NOT_TYPE_RIDER_PICKEDUP_PASSENGER"===t.type?(this.riderStatusObj=t,this.openSnackBar(t.title+t.description,"")):"RM_PASSENGER_JOIN_RIDE_PASSENGER"===t.type||"RM_RIDE_CANCELLED"===t.type||"RE_PASSENGER_REMINDER"===t.type?this.openSnackBar(t.title+t.description,""):(this.openSnackBar(t.title+t.description,""),console.log("New msg received: ",e))):(this.mqtt=t,console.log("Real mqtt 5"),"Rider"===this.mqtt.rideType||"Passenger"===this.mqtt.rideType?(this.mqttObj=t,console.log("a1: ",t)):console.log("mqtt msg1: ",t)),5===this.uniqueId.length&&this.uniqueId.splice(0,3),this.uniqueId.push(t.uniqueID))}},e.prototype.getupcomingride=function(){this.lat=this.rideObject.startLatitude,this.lng=this.rideObject.startLongitude,this.destLat=this.rideObject.endLatitude,this.destLng=this.rideObject.endLongitude,this.latlng={lat:this.lat,lng:this.lng},this.destLatLong={lat:this.destLat,lng:this.destLng}},e.prototype.ngAfterViewInit=function(){},e.prototype.ngOnDestroy=function(){null!=this.findRider&&this.findRider.unsubscribe()},e.prototype.getRideRoute=function(e){this.rideRoute=e,null!==this.latlng&&null!==this.destLatLong||(this.rideRoute=null)},e.prototype.getRidestart=function(e){this.rideStart=e,console.log(this.rideStart)},e.prototype.getLocalData=function(){this.userId=Number(localStorage.getItem("userId")),this.currentVehicle=localStorage.getItem("VehicleList"),this.currentRide=JSON.parse(localStorage.getItem("CurrentRide")),this.passengerList=JSON.parse(localStorage.getItem("passengers")),this.rideStart=JSON.parse(localStorage.getItem("RideStatus")),this.ridePosted=JSON.parse(localStorage.getItem("RidePosted")),this.feedBackForm=JSON.parse(localStorage.getItem("feedBackForm")),JSON.parse(localStorage.getItem("showCurrentRide"))&&(this.showCurrentRideDetails=JSON.parse(localStorage.getItem("showCurrentRide")))},e.prototype.getRouteData=function(e){"Rider"===this.rideObject.dataAsMap.rideType?(this.getRiderRideData(this.rideObject.id,!0),console.log("upcoming new data rider",this.rideObject.routePathPolyline),this.callMyRide=this.rideObject.routePathPolyline,console.log("callMyRide dashoard 1 ",this.callMyRide)):"Passenger"===this.rideObject.dataAsMap.rideType&&(this.getPassengerRideData(this.rideObject.id,!0),console.log("upcoming new data passenger",this.rideObject.routePathPolyline),this.callMyRide=this.rideObject.routePathPolyline,console.log("callMyRide dashoard 2 ",this.callMyRide)),this.rideObject=JSON.parse(localStorage.getItem("CurrentRide")),this.userId=e.userId,this.currentVehicle=localStorage.getItem("VehicleList"),this.currentRide=e,this.passengerList=e.passengers,this.rideStart=e.status,this.ridePosted=JSON.parse(localStorage.getItem("RidePosted")),this.feedBackForm=JSON.parse(localStorage.getItem("feedBackForm")),this.showCurrentRideDetails.endAddress=e.endAddress,this.showCurrentRideDetails.startAddress=e.startAddress,this.showCurrentRideDetails.startTime=e.startTime,this.showCurrentRideDetails.vehicleModel=e.vehicleModel,this.showCurrentRideDetails.vehicleNumber=e.vehicleNumber,this.showCurrentRideDetails.vehicleType=e.vehicleType,console.log("rideObject",e),this.rideStart=!1,"Passenger"===this.currentRide.dataAsMap.rideType?(localStorage.setItem("riderRide",JSON.stringify(!1)),this.showRiderList=!0,this.showRideInfo=!1,localStorage.setItem("showCurrentRide",JSON.stringify(this.showCurrentRideDetails)),localStorage.setItem("CurrentRide",JSON.stringify(this.currentRide)),localStorage.setItem("passengerRide",JSON.stringify(!0)),this.getTakeRidePassangerList(this.currentRide)):(localStorage.setItem("passengerRide",JSON.stringify(!1)),this.showRideInfo=!0,this.showRiderList=!1,localStorage.setItem("CurrentRide",JSON.stringify(this.currentRide)),localStorage.setItem("showCurrentRide",JSON.stringify(this.showCurrentRideDetails)),localStorage.setItem("riderRide",JSON.stringify(!0)),"Scheduled"==this.currentRide.status||"Delayed"==this.currentRide.status?localStorage.setItem("riderRideTripStatus","Ride - Scheduled"):localStorage.setItem("riderRideTripStatus","Ride - In Progress"),this.rideStart="Started"===this.currentRide.status),this.showRide=!1,this.showMap=!0,this.latlng={lat:this.lat,lng:this.lng},this.destLatLong={lat:this.destLat,lng:this.destLng},this.latlng.lat=e.startLatitude,this.latlng.lng=e.startLongitude,this.destLatLong.lat=e.endLatitude,this.destLatLong.lng=e.endLongitude,this.restFlag=!0,this.startTime_pass=e.startTime,this.startAddress_pass=e.startAddress,this.endAddress_pass=e.endAddress,this.vehicleNum_pass=e.vehicleNumber},e.prototype.getPickupCoords=function(e){this.latlng=JSON.parse(e),null!==this.latlng?(this.lat=this.latlng.lat,this.lng=this.latlng.lng,this.coordinates=this.latlng,null!=this.destLat&&null!=this.destLng&&(console.log("latlng in start address",this.lat,this.lng),this.mapComponent.gettingRoutePath(this.lat,this.lng,"pickup"))):(this.lat=null,this.lng=null)},e.prototype.getDestinationCoords=function(e){this.destLatLong=JSON.parse(e),null!==this.destLatLong?(this.destLat=this.destLatLong.lat,this.destLng=this.destLatLong.lng,console.log(this.destLat,this.destLng,this.destLatLong),null!=this.lat&&null!=this.lng&&(console.log("latlng in end address",this.destLat,this.destLng),this.mapComponent.gettingRoutePath(this.destLat,this.destLng,"dest"))):(this.destLat=null,this.destLng=null,this.rideRoute=null)},e.prototype.getPickupAddress=function(e){this.currentAddress=e},e.prototype.getNumberOfSeats=function(e){this.numberOfSeats=e},e.prototype.getDestinationAddress=function(e){this.destinationAddress=e},e.prototype.getRideTime=function(e){this.startTime=e},e.prototype.updatePwaKey=function(){var e=this,t=JSON.parse(localStorage.getItem("userId")),i=JSON.parse(localStorage.getItem("pwakey")),r=new d.h;r=(r=r.append("phone",t)).append("pwaKey",i),this.dashboardService.updatePwaKey(r).subscribe((function(t){e.isLoading=!1}),(function(t){e.isLoading=!1}))},e.prototype.takeRide=function(){var e=this;if(void 0===this.destinationAddress||null===this.numberOfSeats||null===this.currentAddress||null===this.startTime)this.openSnackBar("Please enter all fields !",""),this.recordPWALog("","ride","takeRide","failed","Please enter all fields !","");else{localStorage.setItem("passengerFromLoc",this.currentAddress),localStorage.setItem("passengerToLoc",this.destinationAddress);var t=new d.h;t=(t=(t=(t=(t=(t=(t=(t=(t=t.append("userId",this.userId.toString())).append("startAddress",this.currentAddress)).append("startLatitude",this.lat.toString())).append("startLongitude",this.lng.toString())).append("endAddress",this.destinationAddress)).append("endLatitude",this.destLat.toString())).append("endLongitude",this.destLng.toString())).append("startTime",this.startTime)).append("noOfSeats",this.numberOfSeats),c.a.googleSpotToken===localStorage.getItem("partnerAppToken")&&(t=(t=t.append("paymentType",c.a.GPAY_SPOT)).append("containerApp",c.a.GPAY_CONTAINER)),this.isLoading=!0,this.dashboardService.createPassengerRide(t).subscribe((function(t){e.isLoading=!1,e.Ridestatusupdated=!0,e.headerEnable=!0,e.passengerRidePosted=!0,e.passangerRideId=t.resultData.id,localStorage.setItem("CurrentRide",JSON.stringify(t.resultData)),e.getTakeRidePassangerList(t.resultData),e.currentRide=t.resultData,e.currentRideObject=e.currentRide,e.showCurrentRideDetails.startAddress=e.currentAddress,e.showCurrentRideDetails.endAddress=e.destinationAddress,e.showCurrentRideDetails.startTime=e.currentRide.startTime,localStorage.setItem("showCurrentRide",JSON.stringify(e.showCurrentRideDetails)),localStorage.setItem("passengerRide",JSON.stringify(!0)),localStorage.setItem("firstTimeNavToMatchedUsers",JSON.stringify(!0)),localStorage.setItem("passengerRideTripStatus","Finding rider"),e.showRide=!1,e.userRole=!0,console.log("current usser role in ride called 778"),e.mapComponent.showDeatils(),e.recordPWALog("","ride","takeRide","success","ride created",""),e.openSnackBar3("Fetching ride givers list and will redirect you automatically","")}),(function(t){e.isLoading=!1,e.dialog.open(l.a,{autoFocus:!1,data:t.error.resultData.userMsg}),e.recordPWALog("","ride","takeRide","failed",t.error.resultData.userMsg,"")}))}},e.prototype.postRide=function(){var e=this;if(null!=this.defaultVehicle.regno)if(null==this.destinationAddress||null===this.currentAddress||null===this.startTime)this.openSnackBar("Please enter all details!",""),this.recordPWALog("","ride","postRide","failed","Please enter all details!","");else{var t=new d.h;t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.append("userId",this.userId.toString())).append("startAddress",this.currentAddress)).append("startLatitude",this.lat.toString())).append("startLongitude",this.lng.toString())).append("endAddress",this.destinationAddress)).append("endLatitude",this.destLat.toString())).append("endLongitude",this.destLng.toString())).append("startTime",this.startTime)).append("vehicleNumber",this.defaultVehicle.regno)).append("vehicleModel",this.defaultVehicle.model)).append("availableSeats",this.defaultVehicle.capacity)).append("farePerKm",this.defaultVehicle.fare)).append("capacity",this.defaultVehicle.capacity)).append("vehicleType",this.defaultVehicle.vehicleType),this.isLoading=!0,this.dashboardService.postRide(t).subscribe((function(t){e.isLoading=!1,e.headerEnable=!0,e.Ridestatusupdated=!0,e.rideId=t.resultData.id,localStorage.setItem("riderRideIdJoined",e.rideId),e.currentRide=t.resultData,e.currentRideObject=e.currentRide,e.showCurrentRideDetails.startAddress=e.currentAddress,e.showCurrentRideDetails.endAddress=e.destinationAddress,e.showCurrentRideDetails.vehicleModel=e.defaultVehicle.model,e.userCurrentRideRole=e.currentRide.rideType,localStorage.setItem("userCurrentRole",e.userCurrentRideRole),e.showCurrentRideDetails.vehicleNumber=e.defaultVehicle.regno,e.showCurrentRideDetails.startTime=e.currentRide.startTime,e.showCurrentRideDetails.vehicleType=e.defaultVehicle.vehicleType,localStorage.setItem("CurrentRide",JSON.stringify(e.currentRide)),localStorage.setItem("showCurrentRide",JSON.stringify(e.showCurrentRideDetails)),localStorage.setItem("riderRide",JSON.stringify(!0)),localStorage.setItem("firstTimeNavToMatchedUsers",JSON.stringify(!0)),e.getActiveRides(),e.userRole=!0,console.log("current usser role in ride called 778"),e.recordPWALog("","ride","postRide","success","ride posted",""),e.openSnackBar3("Fetching ride takers list and will redirect you automatically","")}),(function(t){e.isLoading=!1,e.dialog.open(l.a,{autoFocus:!1,data:t.error.resultData.userMsg+" "+t.error.resultData.hintForCorrection}),e.recordPWALog("","ride","postRide","failed",t.error.resultData.userMsg,"")}))}else this.openSnackBar("Please enter vehicle details to continue!",""),this.recordPWALog("","ride","postRide","failed","Please enter vehicle details to continue!","")},e.prototype.updateRide=function(e){var t=this;this.currentRide=JSON.parse(localStorage.getItem("CurrentRide"));var i=new d.h;i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=i.append("startAddress",this.currentAddress)).append("startLatitude",this.lat.toString())).append("startLongitude",this.lng.toString())).append("endAddress",this.destinationAddress)).append("endLatitude",this.destLat.toString())).append("endLongitude",this.destLng.toString())).append("startTime",this.startTime)).append("vehicleNumber",null)).append("vehicleModel",null)).append("availableSeats",null)).append("farePerKm",null)).append("capacity",null)).append("routeId",this.currentRide.routeId)).append("vehicleId",null)).append("capacity",null)).append("id",this.currentRide.id)).append("route",this.rideRoute)).append("makeAndCategory",null)).append("vehicleType",null),this.isLoading=!0,this.dashboardService.updateRide(i).subscribe((function(e){t.isLoading=!1,t.rideId=e.resultData.id,t.currentRide=e.resultData,localStorage.setItem("CurrentRide",JSON.stringify(t.currentRide)),t.getActiveRides()}),(function(e){t.isLoading=!1,t.dialog.open(l.a,{autoFocus:!1,data:e.error.resultData.userMsg})}))},e.prototype.editRide=function(e){this.showEditRideForm=!0,this.showRideInfo=!this.showRideInfo,this.showRide=!0},e.prototype.getCurrentTime=function(){this.currentTime=new Date,this.getStartTime()},e.prototype.getStartTime=function(){this.dd=this.addTrailingZeroToDate(this.currentTime.getDate()),this.MM=this.addTrailingZeroToDate(this.currentTime.getMonth()+1),this.yyyy=this.currentTime.getFullYear().toString(),this.HH=this.addTrailingZeroToDate(this.currentTime.getHours()),this.mm=this.addTrailingZeroToDate(this.currentTime.getMinutes()),this.startTime=this.dd+this.MM+this.yyyy+this.HH+this.mm},e.prototype.addTrailingZeroToDate=function(e){return(e=e>9?e:"0"+e).toString()},e.prototype.changeMapStyles=function(){this.showRideInfo=!this.showRideInfo,this.showRide=!0},e.prototype.startRide=function(){var e=this;this.recordPWALog("","ride","startRide","initiated","",""),localStorage.setItem("riderRideTripStatus","Ride - In progress");var t=new d.h;t=(t=(t=(t=(t=t.append("id",this.rideId)).append("riderRideId",this.rideId)).append("userId",this.userId.toString())).append("status","Started")).append("updateByRider","true"),this.isLoading=!0,this.dashboardService.startRide(t).subscribe((function(t){e.rideStart=!0,localStorage.removeItem("PassengerRequestList"),localStorage.setItem("RideStatus","true"),e.openSnackBar("Ride Started",""),e.isLoading=!1,e.recordPWALog("","ride","startRide","success","",""),e.mapComponent.riderLocationUpdate(),e.NoOfPassengerJoined=!0}),(function(t){e.isLoading=!1,e.dialog.open(l.a,{autoFocus:!1,data:t.error.resultData.userMsg}),e.recordPWALog("","ride","startRide","failed",t.error.resultData.userMsg,"")}))},e.prototype.stopRide=function(){var e=this;if(this.recordPWALog("","ride","stopRide","initiated","",""),null!==localStorage.getItem("completedORCancelledRidesList")){var t=JSON.parse(localStorage.getItem("completedORCancelledRidesList"));(r=[])[0]={id:this.rideId,type:"Rider"};for(var i=0;i<t.length;i++)r[i+1]={id:t[i].id,type:t[i].type};localStorage.setItem("completedORCancelledRidesList",JSON.stringify(r))}else{var r={id:this.rideId,type:"Rider"};localStorage.setItem("completedORCancelledRidesList",JSON.stringify(r))}var s=new d.h;s=s.append("id",this.rideId),this.isLoading=!0,this.dashboardService.stopRide(s).subscribe((function(t){e.rideStart=!1,null!=localStorage.getItem("PassengerRequestList")&&localStorage.removeItem("PassengerRequestList"),null!=localStorage.getItem("RiderRequestList")&&localStorage.removeItem("RiderRequestList"),localStorage.setItem("RideStatus","false"),e.showRideInfo=!1,e.showRide=!0,e.ridePosted=!1,localStorage.setItem("RidePosted","false"),localStorage.removeItem("ParticipantsMarker"),e.RiderRideCompleted=!0,localStorage.removeItem("currentRide"),e.openSnackBar("Ride Stopped",""),localStorage.removeItem("riderRideTripStatus"),localStorage.removeItem("Rideparticipants"),localStorage.removeItem("CurrentRidePathPolyline"),localStorage.removeItem("userCurrentRole"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("tempRiderDetails"),localStorage.removeItem("joinedRiderDetails"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("NewPassengeruserId"),localStorage.removeItem("riderRideIdJoined"),e.showDirection=!1,e.getTripReport(),e.isLoading=!1,e.recordPWALog("","ride","stopRide","success","","")}),(function(t){e.isLoading=!1,e.dialog.open(l.a,{autoFocus:!1,data:t.error.resultData.userMsg}),e.recordPWALog("","ride","stopRide","initiated",t.error.resultData.userMsg,"")}))},e.prototype.cancelRide=function(e){var t=this;if(this.recordPWALog("","ride","cancelRide","initiated","",""),null!==localStorage.getItem("completedORCancelledRidesList")){var i=JSON.parse(localStorage.getItem("completedORCancelledRidesList"));(s=[])[0]={id:this.rideId,type:"Rider"};for(var r=0;r<i.length;r++)s[r+1]={id:i[r].id,type:i[r].type};localStorage.setItem("completedORCancelledRidesList",JSON.stringify(s))}else{var s={id:this.rideId,type:"Rider"};localStorage.setItem("completedORCancelledRidesList",JSON.stringify(s))}var a=new d.h;a=(a=a.append("id",this.rideId)).append("userId",this.userId.toString()),this.isLoading=!0,this.dashboardService.cancelRide(a).subscribe((function(e){t.recordPWALog("","ride","cancelRide","success","",""),t.rideStart=!1,localStorage.setItem("RideStatus","false"),t.showRideInfo=!1,t.showRide=!0,t.ridePosted=!1,t.showDirection=!1,t.getCancelRide(),localStorage.removeItem("showCurrentRide"),localStorage.removeItem("PassengerMarker"),localStorage.removeItem("ParticipantsMarker"),t.mapComponent.showDeatils(),localStorage.removeItem("CurrentRide"),null!=localStorage.getItem("PassengerRequestList")&&localStorage.removeItem("PassengerRequestList"),localStorage.setItem("RidePosted","false"),t.openSnackBar("Ride Cancelled !",""),localStorage.removeItem("showCurrentRide"),localStorage.removeItem("CurrentRide"),localStorage.removeItem("currentRide"),localStorage.removeItem("riderList"),localStorage.removeItem("requestSent"),localStorage.removeItem("inputForRider"),localStorage.removeItem("AllRides"),localStorage.removeItem("invitePassenger"),localStorage.removeItem("notificationReceived"),localStorage.removeItem("passengList"),localStorage.removeItem("requestSentToRider"),localStorage.removeItem("riderRideTripStatus"),localStorage.removeItem("Rideparticipants"),localStorage.removeItem("CurrentRidePathPolyline"),window.location.reload(),t.isLoading=!1}),(function(e){t.isLoading=!1,t.dialog.open(l.a,{autoFocus:!1,data:e.error.resultData.userMsg}),t.recordPWALog("","ride","cancelRide","failed",e.error.resultData.userMsg,""),2649===e.error.resultData.errorCode&&(t.getCancelRide(),t.mapComponent.showDeatils(),window.location.reload())}))},e.prototype.openSnackBar=function(e,t){this.snackBar.open(e,t,{duration:2e3})},e.prototype.openSnackBar3=function(e,t){this.snackBar.open(e,t,{duration:4e3})},e.prototype.checkInvitees=function(e,t){this.snackBar.open(e,t,{duration:5e3})},e.prototype.getAllRides=function(){var e=this,t=new d.h;t=t.append("userId",this.userId.toString()),this.dashboardService.getAllRides(t).subscribe((function(t){e.AllRides=t.resultData,localStorage.setItem("AllRides",JSON.stringify(e.AllRides))}))},e.prototype.getActiveRides=function(){var e=this;this.mapComponent.showDeatils();var t=new d.h;this.isLoading=!0,t=t.append("userId",this.userId.toString()),this.dashboardService.getActiveRides(t).subscribe((function(t){e.isLoading=!1,e.ActiveRides=t.resultData,e.currentRide=e.ActiveRides[e.ActiveRides.length-1],localStorage.setItem("ActiveRides",JSON.stringify(e.ActiveRides)),e.showRideInfo=!0,e.showRide=!1,e.ridePosted=!0,localStorage.setItem("RidePosted","true")}),(function(t){e.isLoading=!1}))},e.prototype.getDefaultVehicle=function(){var e=this,t=new d.h;t=t.append("ownerid",this.userId.toString()),this.dashboardService.getDefaultVehicle(t).subscribe((function(t){e.defaultVehicle=t.resultData}))},e.prototype.getTripReport=function(){var e=this,t=JSON.parse(localStorage.getItem("CurrentRide"));localStorage.removeItem("passengList"),localStorage.removeItem("showCurrentRide"),localStorage.removeItem("CurrentRide"),localStorage.removeItem("currentRide"),localStorage.removeItem("PassengerMarker");var i=new d.h;i=(i=(i=(i=(i=i.append("id",t.id)).append("actualEndTime",this.startTime)).append("startAddress",t.startAddress)).append("endAddress",t.endAddress)).append("userId",t.userId),this.dashboardService.getTripReport(i).subscribe((function(t){console.log("trip report",t.resultData),localStorage.removeItem("CurrentRide"),localStorage.removeItem("currentRide"),localStorage.removeItem("PassengerMarker"),localStorage.removeItem("showCurrentRide"),localStorage.removeItem("passengerRide"),e.tripReport=t.resultData,console.log("trip report1",e.tripReport),localStorage.setItem("tripReport",JSON.stringify(e.tripReport)),e.tripCompleted=!0,localStorage.setItem("tripCompleted","true"),e.ngOnInit()}))},e.prototype.showTripReport=function(e){this.tripCompleted="true"===e,console.log("this.tripCompleted",this.tripCompleted)},e.prototype.showFeedback=function(e){this.feedBackForm=!0,localStorage.setItem("feedBackForm","true"),this.rider=JSON.parse(e),this.riderId=this.rider.riderId,this.riderName=this.rider.name},e.prototype.showNewRide=function(e){this.feedBackForm=!1,this.tripCompleted=!1,this.showRiderList=!1,this.showRideInfo=!1,this.showRide=!0,localStorage.removeItem("showCurrentRide"),localStorage.removeItem("CurrentRide"),localStorage.removeItem("riderList"),localStorage.removeItem("requestSent"),localStorage.removeItem("passengerTripReport"),localStorage.removeItem("inputForRider"),localStorage.removeItem("riderList"),localStorage.removeItem("currentRide"),localStorage.removeItem("requestSentToRider")},e.prototype.showNewRide2=function(e){this.feedBackForm=!1,this.tripCompleted=!1},e.prototype.getTakeRidePassangerList=function(e){var t=this,i=0,s=e.id;console.log("input.id 1",e.id,s),this.isLoading=!0,this.findRider=r.Observable.interval(5e3).subscribe((function(r){if(4==(i+=1))t.findRider.unsubscribe();else{console.log("input.id 2",e.id,s);var a=new d.h;a=(a=(a=(a=(a=(a=(a=(a=(a=a.append("id",s)).append("startLatitude",e.startLatitude)).append("startLongitude",e.startLongitude)).append("endLatitude",e.endLatitude)).append("endLongitude",e.endLongitude)).append("startTime",e.startTime)).append("userId",e.userId)).append("route",e.routePathPolyline)).append("noOfSeats",e.noOfSeats),t.dashboardService.findMatchingRiders(a).subscribe((function(i){t.isLoading=!1,t.riderList=i.resultData.matchedRiders,localStorage.setItem("riderList",JSON.stringify(t.riderList)),localStorage.setItem("inputForRider",JSON.stringify(e)),t.showRiderList=!0,t.showRide=!1,t.showRideInfo=!1,t.findRider.unsubscribe(),console.log("input.id 3",e.id,s)}))}}))},e.prototype.getCancelRide=function(){this.showRiderList=!1,this.showRide=!0,this.showRideInfo=!1,localStorage.removeItem("showCurrentRide"),localStorage.removeItem("CurrentRide"),localStorage.removeItem("passengerList"),localStorage.removeItem("RiderRequestList"),localStorage.removeItem("currentRide"),localStorage.removeItem("riderRide"),localStorage.removeItem("RidePosted"),localStorage.removeItem("ActiveRides"),localStorage.removeItem("riderList"),localStorage.removeItem("requestSent"),localStorage.removeItem("inputForRider"),localStorage.removeItem("AllRides"),localStorage.removeItem("invitePassenger"),localStorage.removeItem("notificationReceived"),localStorage.removeItem("passengerRide"),localStorage.removeItem("riderInviteList"),localStorage.removeItem("requestSentToRider"),localStorage.removeItem("passengerTripReport"),localStorage.removeItem("userCurrentRole"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("joinedRiderDetails"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("NewPassengeruserId"),localStorage.removeItem("riderRideIdJoined")},e.prototype.cancelPassangerRide=function(e){var t=this,i=JSON.parse(localStorage.getItem("CurrentRide")).id;if(null!==localStorage.getItem("completedORCancelledRidesList")){var r=JSON.parse(localStorage.getItem("completedORCancelledRidesList"));(a=[])[0]={id:i,type:"Passenger"};for(var s=0;s<r.length;s++)a[s+1]={id:r[s].id,type:r[s].type};localStorage.setItem("completedORCancelledRidesList",JSON.stringify(a))}else{var a={id:i,type:"Passenger"};localStorage.setItem("completedORCancelledRidesList",JSON.stringify(a))}this.isLoading=!0;var o=new d.h;o=(o=o.append("id",i)).append("userId",this.userId.toString()),this.dashboardService.cancelPassangerRide(o).subscribe((function(e){t.openSnackBar("Passenger ride cancelled!",""),t.getCancelRide(),t.showRiderList=!1,t.showRideInfo=!1,t.showRide=!0,t.mapComponent.showDeatils(),window.location.reload(),t.isLoading=!1,localStorage.removeItem("CurrentRidePathPolyline"),localStorage.removeItem("userCurrentRole"),localStorage.removeItem("PassengerRouteDetails"),localStorage.removeItem("tempRiderDetails"),localStorage.removeItem("NewPassengeruserId")}),(function(e){t.isLoading=!1,t.dialog.open(l.a,{autoFocus:!1,data:e.error.resultData.userMsg}),2649===e.error.resultData.errorCode&&(t.getCancelRide(),t.mapComponent.showDeatils(),window.location.reload())}))},e.prototype.reschedulePassangerRide=function(e){this.currentRide=JSON.parse(localStorage.getItem("CurrentRide"));var t={lat:this.currentRide.startLatitude,lng:this.currentRide.startLongitude},i={lat:this.currentRide.endLatitude,lng:this.currentRide.endLongitude};this.showRide=!0,this.showRiderList=!1,this.reschedulePassanger="Edit_Ride",localStorage.setItem("reschedulePassanger",JSON.stringify(this.reschedulePassanger)),this.latlng=t,this.destLatLong=i,this.currentAddress=this.currentRide.startAddress,this.destinationAddress=this.currentRide.endAddress,this.numberOfSeats=this.currentRide.paramsMap.noOfSeats},e.prototype.getcallPassangerEditRide=function(e){var t=this;this.currentRide=JSON.parse(localStorage.getItem("CurrentRide"));var i=new d.h;i=(i=(i=(i=(i=(i=(i=(i=(i=i.append("startAddress",this.currentAddress)).append("startLatitude",this.lat.toString())).append("startLongitude",this.lng.toString())).append("endAddress",this.destinationAddress)).append("endLatitude",this.destLat.toString())).append("endLongitude",this.destLng.toString())).append("startTime",this.startTime)).append("noOfSeats",this.numberOfSeats)).append("id",this.currentRide.id),this.isLoading=!0,this.dashboardService.updatePassangerRide(i).subscribe((function(e){t.passangerRideId=e.resultData.id,localStorage.setItem("CurrentRide",JSON.stringify(e.resultData)),t.getTakeRidePassangerList(e),t.openSnackBar("Ride updated!",""),t.showCurrentRideDetails.startAddress=t.currentAddress,t.showCurrentRideDetails.endAddress=t.destinationAddress,localStorage.setItem("showCurrentRide",JSON.stringify(t.showCurrentRideDetails)),t.isLoading=!1}),(function(e){t.isLoading=!1}))},e.prototype.getPassengerCheckout=function(e){e&&this.getPassengerTripReport(e)},e.prototype.getPassengerTripReport=function(e){var t=this;if(null!==localStorage.getItem("completedORCancelledRidesList")){var i=JSON.parse(localStorage.getItem("completedORCancelledRidesList"));(s=[])[0]={id:e,type:"Passenger"};for(var r=0;r<i.length;r++)s[r+1]={id:i[r].id,type:i[r].type};localStorage.setItem("completedORCancelledRidesList",JSON.stringify(s))}else{var s={id:e,type:"Passenger"};localStorage.setItem("completedORCancelledRidesList",JSON.stringify(s))}var a=new d.h;a=(a=a.append("userId",this.userId.toString())).append("id",e),this.dashboardService.getPassengerTripReport(a).subscribe((function(e){localStorage.setItem("passengerTripReport",JSON.stringify(!0)),t.tripReport=e.resultData,localStorage.setItem("tripReport",JSON.stringify(t.tripReport)),t.tripCompleted=!0,localStorage.setItem("tripCompleted","true"),console.log("passenger trip report ",e)}))},e.prototype.freezeRide=function(e){var t=this,i=JSON.parse(localStorage.getItem("CurrentRide"));if(JSON.parse(localStorage.getItem("CurrentRide"))){var r=new d.h;r=(r=r.append("id",i.id)).append("freezeRide","true"),this.isLoading=!0,this.dashboardService.freezeRiderRide(r).subscribe((function(e){t.isLoading=!1,(e.result="SUCCESS")&&t.openSnackBar("Ride Frezzed!","")}),(function(e){t.isLoading=!1}))}},e.prototype.unFreezeRide=function(e){var t=this,i=JSON.parse(localStorage.getItem("CurrentRide"));if(JSON.parse(localStorage.getItem("CurrentRide"))){var r=new d.h;this.isLoading=!0,r=(r=r.append("id",i.id)).append("freezeRide","false"),this.dashboardService.freezeRiderRide(r).subscribe((function(e){t.isLoading=!1,(e.result="SUCCESS")&&t.openSnackBar("Ride Unfrezzed!","")}),(function(e){t.isLoading=!1}))}},e.prototype.cacheCleanup=function(){this.rideStart=!1,localStorage.setItem("RideStatus","false"),this.showRideInfo=!1,this.showRide=!0,this.ridePosted=!1,this.showDirection=!1,localStorage.removeItem("PassengerMarker"),localStorage.removeItem("LiveRideCurrentData"),localStorage.removeItem("showCurrentRide"),localStorage.removeItem("CurrentRide"),localStorage.setItem("RidePosted","false"),localStorage.removeItem("showCurrentRide"),localStorage.removeItem("CurrentRide"),localStorage.removeItem("riderList"),localStorage.removeItem("requestSent"),localStorage.removeItem("inputForRider"),localStorage.removeItem("AllRides"),localStorage.removeItem("invitePassenger"),localStorage.removeItem("notificationReceived"),localStorage.removeItem("currentRide"),localStorage.removeItem("tempArr"),localStorage.removeItem("requestSentToRider"),localStorage.removeItem("tripReport"),localStorage.removeItem("passengerTripReport"),localStorage.removeItem("showCheckInButton"),localStorage.removeItem("riderInviteList"),localStorage.removeItem("passengList"),localStorage.removeItem("CurrentRidePathPolyline")},e.prototype.initializeFirebase=function(){var e=JSON.parse(localStorage.getItem("userId"));this.firebaseMessagingService.requestPermission(e),this.firebaseMessagingService.receiveMessage(),this.message=this.firebaseMessagingService.currentMessage},e.prototype.newMessageReceived=function(e){var t=[];if(console.log("this.newMessageReceived inside-1646",e),null!==e&&(this.msgObj=JSON.parse(e.data.MsgObject),console.log("Phase1 check uniqueId-1649",!this.uniqueId.includes(this.msgObj.uniqueID)),!this.uniqueId.includes(this.msgObj.uniqueID))){if(console.log("Phase1 check user notififation","true"===e.data.IS_USER_NOTIFICATION),"true"===e.data.IS_USER_NOTIFICATION)console.log("messageType",e.data.Type,e),"RM_RIDER_INVITATION"!==e.data.Type&&"RM_PASSENGER_INVITATION"!==e.data.Type&&"NOT_TYPE_RM_INVITATION_TO_OLD_USER"!==e.data.Type&&"NOT_TYPE_RM_CONTACT_INVITATION"!==e.data.Type&&"RM_RIDER_INVITATION_REQ_FARE"!==e.data.Type||this.updateInvitationStatusAsRead(JSON.parse(e.data.MsgObject)),"RM_RIDER_INVITATION"===e.data.Type?(this.passengerAllStat=JSON.parse(e.data.MsgObject),this.openSnackBar(e.data.Title+e.data.Description,"")):"RM_PASSENGER_INVITATION"===e.data.Type?(this.RiderRequest=!0,this.riderInvitationObj=JSON.parse(e.data.MsgObject),this.openSnackBar(e.data.Title+e.data.Description,"")):"NOT_TYPE_RIDER_PICKEDUP_PASSENGER"===e.data.Type?(this.riderStatusObj=e.data,this.openSnackBar(e.data.Title+e.data.Description,"")):"RM_PASSENGER_JOIN_RIDE_PASSENGER"===e.data.Type||"RM_RIDE_CANCELLED"===e.data.Type||"RE_PASSENGER_REMINDER"===e.data.Type?this.openSnackBar(e.data.Title+e.data.Description,""):"true"==e.data.IS_PERSONAL_CHAT_MSG?(console.log("New msg received: chat ",e.data.IS_PERSONAL_CHAT_MSG,e.data.MsgObject.sourceName,e.data.MsgObject.message,e,e.data,e.data.MsgObject),this.openSnackBar(e.data.Title+e.data.Description,"")):(this.openSnackBar(e.data.Title+e.data.Description,""),console.log("New msg received: ",e));else if(console.log("mqtt msg: ",JSON.parse(e.data.MsgObject)),this.mqtt=JSON.parse(e.data.MsgObject),console.log("Phase2 ridetype",this.mqtt.riderType),"Rider"===this.mqtt.rideType||"Passenger"===this.mqtt.rideType){if(this.mqttObj=JSON.parse(e.data.MsgObject),null!=this.mqttObj.invitationStatus?(console.log("this.mqttObj.invitationStatus 1",this.mqttObj.invitationStatus),"Accepted"==this.mqttObj.invitationStatus?(console.log("this.mqttObj.invitationStatus 2",this.mqttObj.invitationStatus),this.PassengerJoinedAlert=!0):console.log("this.mqttObj.invitationStatus 3",this.mqttObj.invitationStatus)):console.log("this.mqttObj.invitationStatus 4",this.mqttObj),console.log("mqttobj new Phase2 a1-1782: ",this.mqttObj,JSON.parse(e.data.MsgObject)),t=[],null!=this.mqttObj.status&&null!=this.mqttObj.rideType&&"Started"===this.mqttObj.status&&"Passenger"===this.mqttObj.rideType){if(null!=localStorage.getItem("checkInPassengerList")){var i=JSON.parse(localStorage.getItem("checkInPassengerList"));length=i.length;for(var r=0;r<length;r++)t.push({userId:i.userId,passengerNo:i.passengerNo});t.push({userId:this.mqttObj.userId,passengerNo:t.length+1}),localStorage.setItem("checkInPassengerList",JSON.stringify(t))}else t.push({userId:this.mqttObj.userId,passengerNo:t.length+1}),localStorage.setItem("checkInPassengerList",JSON.stringify(t));this.PassengerCheckInAlert=!0}}else console.log("mqtt msg1:phase2-1797 ",JSON.parse(e.data.MsgObject));5===this.uniqueId.length&&this.uniqueId.splice(0,3),this.uniqueId.push(this.msgObj.uniqueID)}},e.prototype.closeNav=function(){var e=document.getElementById("qr-sidebar"),t=document.getElementById("dashboard-overlay");e.style.left="0px",t.style.visibility="hidden",this.isClosable&&(this.showMenuIcon=!0),console.log("toggleSidebar 5",!1)},e.prototype.toggleSidebar=function(){var e=document.getElementById("qr-sidebar"),t=document.getElementById("dashboard-overlay");"0px"==e.style.left?(e.style.left="343px",t.style.visibility="visible"):(e.style.left="0px",t.style.visibility="hidden"),this.isClosable=!0,this.showMenuIcon=!this.showMenuIcon,console.log("toggleSidebar 6",!1)},e.prototype.showHideMenuIcon=function(e){console.log("toggleSidebar 3",!1),this.isClosable=!1,this.showMenuIcon=e,console.log("showHideMenuIcon",this.showMenuIcon,e)},e.prototype.updateInvitationStatusAsRead=function(e){var t=new d.h;t=(t=t.append("Invitation_id",e.id)).append("Invitation_status","Read"),this.dashboardService.updateInvitationStatus(t).subscribe((function(e){}))},e.prototype.getFavLocation=function(){var e=this,t=new d.h;t=t.append("phone",localStorage.getItem("userId")),console.log("loc params",t.toString()),this.profileService.getFavouriteLocation(t).subscribe((function(t){localStorage.setItem("userFavLocations",JSON.stringify(t.resultData)),e.userFavLocations=t.resultData}),(function(e){alert(e.error.resultData.userMsg)}))},e.prototype.getDistanceFromLatLonInKm=function(e,t,i,r){var s=this.deg2rad(i-e),a=this.deg2rad(r-t),o=Math.sin(s/2)*Math.sin(s/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(i))*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371},e.prototype.deg2rad=function(e){return e*(Math.PI/180)},e.prototype.defaultnotificationcount=function(){localStorage.setItem("notificationcount","0")},e.prototype.getEncashInfo=function(){console.log(localStorage.getItem("userId"));var e=localStorage.getItem("userId"),t=new d.h;t=t.append("accountid",e),this.dashboardService.getBalance(t).subscribe((function(e){localStorage.setItem("earnedAmount",e.resultData.earnedPoints+e.resultData.rewardsPoints)}),(function(e){console.log(e)}))},e.prototype.passingRouthPath=function(e){this.routePath=e,console.log("passing Routh Path",e)},e.prototype.MapIconLocationUpdate=function(e,t){"new"==t&&(console.log("mapIconLocationUpdate"),this.mapIconLocationUpdate=!0),"old"==t&&(console.log("updateMapIcon"),this.updateMapIcon=!0)},e.prototype.unjoinedPassengeruserId=function(e){this.unjoinedPassengerId=e},e.prototype.getupdateposition=function(e){this.updateIconPosition=e},e.prototype.removeRiderRoutePathFromMap=function(e){this.hideRiderRoutePathFromMap=e},e.prototype.getUserRole=function(e){this.userRole=!0},e.prototype.getjoinedRider=function(e){this.RiderJoined=!0},e.prototype.initFavLocationLatLng=function(){this.FavLocationLatLng=!0},e.prototype.onSwapAddress=function(e){this.onSwapAddressFromRide=!0},e}()},xXU7:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("6blF"),s=i("T1DM"),a=i("/21U");function o(e,t){return void 0===e&&(e=0),void 0===t&&(t=s.a),(!Object(a.a)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=s.a),new r.a((function(i){return i.add(t.schedule(n,e,{subscriber:i,counter:0,period:e})),i}))}function n(e){var t=e.subscriber,i=e.counter,r=e.period;t.next(i),this.schedule({subscriber:t,counter:i+1,period:r},r)}}}]);